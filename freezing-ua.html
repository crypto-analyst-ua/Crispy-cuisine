<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Хрустка кухня - Заморозка овочів на зиму</title>

        <!-- CSS FILES -->  
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">                      
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-icons.css" rel="stylesheet">
        <link href="css/tooplate-crispy-kitchen.css" rel="stylesheet">
        <style>
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-label {
            display: block;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .file-input-label:hover {
            background-color: #f8f9fa;
        }
        
        .file-input-label input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        .file-name {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .recipe-preview {
            margin-top: 2rem;
            display: none;
        }
        
        .recipe-card {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: transform 0.3s ease;
        }
        
        .recipe-card:hover {
            transform: translateY(-5px);
        }
        
        .user-recipe-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        
        .menu-image-wrap {
            position: relative;
        }
        
        .recipe-form {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .form-title {
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #198754;
        }
        
        .carousel-link {
            display: block;
            position: relative;
            color: inherit;
            text-decoration: none;
        }
        
        .carousel-link:hover {
            text-decoration: none;
        }
        
        .carousel-link .carousel-caption {
            z-index: 10;
        }
        
        .carousel-link::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            display: none;
        }
        
        #loadingRecipes {
            text-align: center;
            padding: 2rem;
        }
        
        .recipe-modal .modal-content {
            border-radius: 0.8rem;
            overflow: hidden;
        }
        
        .recipe-modal .modal-header {
            background: linear-gradient(to right, #28a745, #20c997);
            color: white;
            border-bottom: none;
        }
        
        .recipe-modal .modal-body {
            padding: 1.5rem;
        }
        
        .recipe-modal .modal-footer {
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .recipe-ingredients {
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .recipe-instructions {
            white-space: pre-line;
            line-height: 1.8;
        }
    </style>
</head>
    
    <body>
        <nav class="navbar navbar-expand-lg bg-white shadow-lg">
            <div class="container">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <a class="navbar-brand" href="index.html">
                    Хрустка кухня
                </a>

                <div class="d-lg-none"></div>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Головна</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="top-ua.html">Перше</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="top2-ua.html">Друге</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="desert-ua.html">Десерт</a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="freezing-ru.html"><span class="category-tag me-3 bg-info">RU</span></a>                  
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <main>
            <header class="site-header site-news-detail-header">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <h2>Заморозка овочів на зиму</h2>
                        </div>
                    </div>
                </div>
            </header>

            <section class="news-detail section-padding pt-0">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <img src="images/news/news-detail-header4.jpg" class="img-fluid news-detail-image" alt="Заморожені овочі">

                            <div class="col-lg-10 col-10 mx-auto mt-5">
                                <h4 class="mb-3">Чому варто заморожувати овочі?</h4>
                                <p>
                                    Заморожування овочів - це найкращий спосіб зберегти вітаміни та корисні речовини на довгий час. На відміну від консервації, заморожування не потребує додавання солі, цукру чи оцту, що робить овочі більш корисними для здоров'я. Заморожені овочі зберігають до 90% своїх поживних властивостей і є відмінною основою для супів, рагу, салатів та інших страв протягом усього року.
                                </p>

                                <h4 class="mb-3">Основні правила заморозки овочів:</h4>
                                <ul class="list">
                                    <li class="list-item">Вибирайте свіжі, дозрілі, але не перестиглі овочі</li>
                                    <li class="list-item">Ретельно мийте та просушивайте овочі перед заморожуванням</li>
                                    <li class="list-item">Нарізайте овочі на однакові шматочки для рівномірної заморозки</li>
                                    <li class="list-item">Використовуйте спеціальні пакети для заморожування або контейнери</li>
                                    <li class="list-item">Видаляйте повітря з пакетів перед закриттям</li>
                                    <li class="list-item">Маркуйте пакети з датою заморозки</li>
                                    <li class="list-item">Зберігайте при температурі -18°C та нижче</li>
                                </ul>
                                
                                <h4 class="mb-3">Заморозка болгарського перцю</h4>
                                <ul class="list">
                                    <li class="list-item">Болгарський перець</li>
                                    <li class="list-item">Ніж для очищення</li>
                                    <li class="list-item">Дошки для нарізки</li>
                                </ul>
                                <p>
                                    Перець вимити, видалити насіння та плодоніжку. Можна заморожувати цілими для фарширування, соломкою для салатів або кубиками для рагу. Для зручності можна вкладати один в один цілі перціни. Розкласти на деко або таці в один шар, заморозити, потім перекласти в пакети. Так перець не змерзнеться в один ком.
                                </p>

                                <h4 class="mb-3">Заморозка зеленого горошку</h4>
                                <ul class="list">
                                    <li class="list-item">Свіжі стручки зеленого горошку</li>
                                    <li class="list-item">Каструля з окропом</li>
                                    <li class="list-item">Миска з холодною водою та льодом</li>
                                </ul>
                                <p>
                                    Горошок вилущити зі стручків. Довести воду до кипіння, опустити горошок на 2-3 хвилини. Витягнути шумівкою і відразу опустити в миску з крижаною водою на 2-3 хвилини. Це допоможе зберегти колір та поживні речовини. Процідити через дуршлаг, розкласти на рушник для просушування. Розкласти на деко в один шар, заморозити. Пересипати заморожений горошок в пакети для заморожування.
                                </p>

                                <h4 class="mb-3">Заморозка кукурудзи</h4>
                                <ul class="list">
                                    <li class="list-item">Молоді качани кукурудзи</li>
                                    <li class="list-item">Велика каструля</li>
                                    <li class="list-item">Олівець для відділення зерен</li>
                                </ul>
                                <p>
                                    Очистити качани від листя та волокон. Опустити в киплячу воду на 5-7 хвилин, потім перекласти в холодну воду. Коли качани охолонуть, ножем або спеціальним пристроєм зіскребти зерна. Розкласти зерна на деко в один шар, заморозити. Пересипати в пакети або контейнери. Можна заморожувати цілі качани, обернувши їх у харчову плівку.
                                </p>
                                
                                <h4 class="mb-3">Заморозка брокколі та цвітної капусти</h4>
                                <ul class="list">
                                    <li class="list-item">Капуста брокколі</li>
                                    <li class="list-item">Цвітна капуста</li>
                                    <li class="list-item">Сіль (для бланшування)</li>
                                </ul>
                                <p>
                                    Розібрати капусту на невеликі суцвіття. Приготувати розсіл: 1 л води + 1 ст.л солі. Довести до кипіння, опустити капусту на 3 хвилини. Вийняти шумівкою і опустити в миску з крижаною водою. Обсушити на рушнику. Розкласти на деко, заморозити. Перекласти в пакети для зберігання. Така капуста чудово підходить для супів, овочевих рагу та гарнірів.
                                </p>

                                <h4 class="mb-3">Заморожені овочеві суміші</h4>
                                <ul class="list">
                                    <li class="list-item">Морква</li>
                                    <li class="list-item">Цибуля</li>
                                    <li class="list-item">Сельдера</li>
                                    <li class="list-item">Болгарський перець</li>
                                    <li class="list-item">Зелена квасоля</li>
                                </ul>
                                <p>
                                    Овочі вимити, очистити та нарізати однаковими шматочками. Моркву та квасолю попередньо бланшувати 2-3 хвилини. Цибулю та перець заморожувати свіжими. Змішати овочі в бажаній пропорції. Розкласти суміш на деко в один шар, заморозити. Пересипати в пакети. Такі суміші ідеальні для приготування супів, рагу, запіканок та як гарнір до м'яса.
                                </p>

                                <h4 class="mb-3">Заморозка зелених овочів (шпинат, щавель, кроп)</h4>
                                <ul class="list">
                                    <li class="list-item">Свіжа зелень</li>
                                    <li class="list-item">Лотки для кубиків льоду</li>
                                    <li class="list-item">Оливкова олія або бульйон</li>
                                </ul>
                                <p>
                                    Зелень ретельно промити, обсушити. Порізати. Можна заморозити в пакетах, видаливши повітря. Або зробити "зелені кубики": зелень щільно укласти в лотки для льоду, залити оливковою олією або бульйоном, заморозити. Потім перекласти кубики в пакет. Такі кубики зручно додавати в супи, соуси, овочеві рагу.
                                </p>

                                <h4 class="mb-3">Заморозка кабачків та баклажанів</h4>
                                <ul class="list">
                                    <li class="list-item">Молоді кабачки</li>
                                    <li class="list-item">Баклажани</li>
                                    <li class="list-item">Сіль для видалення гіркоти</li>
                                </ul>
                                <p>
                                    Кабачки помити, при необхідності очистити від шкірки. Нарізати кружальцями, кубиками або соломкою. Баклажани нарізати кружальцями, посолити і залишити на 20 хвилин, щоб вийшла гіркота. Промити та обсушити. Розкласти на деко в один шар, заморозити. Перекласти в пакети. Заморожені кабачки та баклажани добре підходять для овочевих рагу, запіканок та ікри.
                                </p>

                                <h4 class="mb-3">Заморозка помідорів</h4>
                                <ul class="list">
                                    <li class="list-item">Дрібні помідори чері</li>
                                    <li class="list-item">Великі м'ясисті помідори</li>
                                    <li class="list-item">Блендер (для пюре)</li>
                                </ul>
                                <p>
                                    Дрібні помідори чері заморожувати цілими. Вимити, обсушити, розкласти на деко в один шар, заморозити. Пересипати в пакет. Використовувати для супів, рагу. Великі помідори: нарізати кружальцями або кубиками, заморозити на деці. Або зробити томатне пюре: помидори подрібнити блендером, розлити в формочки для льоду або маленькі стаканчики, заморозити. Перекласти кубики в пакет. Використовувати для супів, соусів, піци.
                                </p>
                                
                                <div class="col-12">
                                    <h2>Поради щодо зберігання та використання</h2>
                                </div>
                                
                                <div class="col-lg-12 col-12">
                                    <img src="images/news/frozen-vegetables-storage.jpg" class="img-fluid news-detail-image" alt="Зберігання заморожених овочів">
                                </div>                                                                                                           
                                
                                <h4 class="mb-3">Як правильно розморожувати овочі</h4>
                                <p>
                                    Для збереження смаку та корисних речовин овочі не варто розморожувати при кімнатній температурі. Найкращі способи:
                                </p>
                                <ul class="list">
                                    <li class="list-item">Без розморожування додавати в страви, що готуються</li>
                                    <li class="list-item">Розморожувати в холодильнику протягом ночі</li>
                                    <li class="list-item">Використовувати мікрохвильову піч на спеціальному режимі</li>
                                </ul>
                                <p>
                                    Не рекомендується повторно заморожувати овочі - це призводить до втрати смаку та корисних властивостей.
                                </p>                              

                                <h4 class="mb-3">Терміни зберігання заморожених овочів</h4>
                                <p>
                                    При правильній заморозці та зберіганні при температурі -18°C:
                                </p>
                                <ul class="list">
                                    <li class="list-item">Кабачки, баклажани, перець - 10-12 місяців</li>
                                    <li class="list-item">Брокколі, цвітна капуста - 8-10 місяців</li>
                                    <li class="list-item">Морква, горошок, кукурудза - 12-14 місяців</li>
                                    <li class="list-item">Помідори, зелень - 6-8 місяців</li>
                                    <li class="list-item">Овочеві суміші - 8-10 місяців</li>
                                </ul>
                                <p>
                                    Обов'язково маркуйте пакети з датою заморозки та назвою продукту!
                                </p>
                                
                                <h4 class="mb-3">Які страви готувати з заморожених овочів</h4>
                                <ul class="list">
                                    <li class="list-item">Овочеві супи та борщі</li>
                                    <li class="list-item">Рагу та овочеві запіканки</li>
                                    <li class="list-item">Гарніри до м'ясних та рибних страв</li>
                                    <li class="list-item">Омлети та яєчні</li>
                                    <li class="list-item">Піца та паста</li>
                                    <li class="list-item">Смузі та овочеві коктейлі</li>
                                </ul>
                                <p>
                                    Заморожені овочі - це швидкий та корисний спосіб приготувати смачну та поживну страву в будь-який час року!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        <section class="BgImage"></section>

        <!-- Секция для добавления рецептов -->
        <section id="add-recipe" class="section-padding">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-12">
                        <div class="recipe-form">
                            <h2 class="form-title">Додати свій рецепт</h2>
                            <form id="recipeForm">
                                <div class="mb-3">
                                    <label for="recipeTitle" class="form-label">Назва рецепту*</label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="recipeTitle" 
                                        required 
                                        placeholder="Введіть назву вашого рецепту"
                                    >
                                </div>
                                <div class="mb-3">
                                    <label for="recipeCategory" class="form-label">Категорія*</label>
                                    <select class="form-select" id="recipeCategory" required>
                                        <option value="">Виберіть категорію</option>
                                        <option value="Сніданок">Сніданок</option>
                                        <option value="Обід">Обід</option>
                                        <option value="Вечеря">Вечеря</option>
                                        <option value="Десерт">Десерт</option>
                                        <option value="Пістне">Пістне</option>
                                        <option value="Консервація">Консервація</option>
                                        <option value="Випічка">Випічка</option>
                                        <option value="Напої">Напої</option>
                                        <option value="Салати">Салати</option>
                                        <option value="Закуски">Закуски</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Зображення (опціонально)</label>
                                    <div class="file-input-wrapper">
                                        <div class="file-input-label">
                                            <i class="bi bi-upload me-2"></i>Обрати файл
                                            <input 
                                                type="file" 
                                                class="form-control" 
                                                id="recipeImageFile" 
                                                accept="image/*"
                                            >
                                        </div>
                                        <span id="fileName" class="file-name">Файл не обрано</span>
                                    </div>
                                    <div class="form-text">Максимальний розмір: 1MB (JPG, PNG)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="recipeIngredients" class="form-label">Інгредієнти*</label>
                                    <textarea 
                                        class="form-control" 
                                        id="recipeIngredients" 
                                        rows="4" 
                                        required 
                                        placeholder="Перелічіть інгредієнти, кожен з нового рядка"
                                    ></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="recipeInstructions" class="form-label">Інструкція приготування*</label>
                                    <textarea 
                                        class="form-control" 
                                        id="recipeInstructions" 
                                        rows="6" 
                                        required 
                                        placeholder="Опишіть кроки приготування"
                                    ></textarea>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <span 
                                            id="submitSpinner" 
                                            class="spinner-border spinner-border-sm me-2" 
                                            role="status" 
                                            aria-hidden="true"
                                        ></span>
                                        Додати рецепт
                                    </button>
                                </div>
                            </form>
                            
                            <div id="recipePreview" class="recipe-preview mt-4">
                                <h4>Попередній перегляд:</h4>
                                <div class="card recipe-card">
                                    <img 
                                        id="previewImage" 
                                        src="images/default-recipe.jpg" 
                                        class="card-img-top" 
                                        alt="Попередній перегляд"
                                    >
                                    <div class="card-body">
                                        <h5 id="previewTitle" class="card-title">Назва рецепту</h5>
                                        <p id="previewCategory" class="card-text text-muted">Категорія: не вибрано</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Раздел для отображения пользовательских рецептов -->
        <section id="user-recipes" class="section-padding bg-white">
            <div class="container">
                <div class="row">
                    <h2 class="text-center mb-lg-5 mb-4">Рецепти від користувачів</h2>
                    
                    <div id="loadingRecipes">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Завантаження...</span>
                        </div>
                        <p class="mt-3">Завантажуємо рецепти...</p>
                    </div>
                    
                    <div id="recipesContainer" class="row">
                        <!-- Сюда будут добавляться рецепты через JS -->
                    </div>
                    
                    <div id="noRecipesMessage" class="col-12 text-center d-none">
                        <p>Поки немає доданих рецептів. Будьте першим!</p>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button id="loadMoreBtn" class="btn btn-outline-success d-none">Показати ще</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer section-padding">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h4 class="text-white mb-4 me-5">Хрустка кухня</h4>
                </div>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT FILES -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/custom.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <script>
        // Конфигурация Firebase (ЗАМЕНИТЕ НА ВАШУ КОНФИГУРАЦИЮ)
        const firebaseConfig = {
            apiKey: "ВАШ_API_KEY",
            authDomain: "ВАШ_PROJECT.firebaseapp.com",
            projectId: "ВАШ_PROJECT",
            storageBucket: "ВАШ_PROJECT.appspot.com",
            messagingSenderId: "ВАШ_SENDER_ID",
            appId: "ВАШ_APP_ID"
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Глобальные переменные
        let lastVisible = null;
        let selectedFile = null;
        const PAGE_SIZE = 6; // Количество рецептов за одну загрузку

        $(document).ready(function() {
            // Загрузка первых рецептов
            loadRecipes();
            
            // Обработчики событий
            $('#recipeForm').submit(handleFormSubmit);
            $('#recipeImageFile').on('change', handleImageUpload);
            $('#recipeTitle, #recipeCategory').on('input change', updatePreview);
            $('#loadMoreBtn').on('click', loadMoreRecipes);
        });

        // Обработка загрузки изображения
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) {
                $('#fileName').text('Файл не обрано');
                selectedFile = null;
                return;
            }

            // Проверка типа файла
            if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                alert('Будь ласка, виберіть файл у форматі JPG або PNG.');
                resetFileInput();
                return;
            }

            // Проверка размера файла
            if (file.size > 1048576) {
                alert('Файл занадто великий. Максимальний розмір 1MB.');
                resetFileInput();
                return;
            }

            $('#fileName').text(file.name);
            
            const reader = new FileReader();
            reader.onload = function(event) {
                selectedFile = event.target.result;
                updatePreview();
            };
            reader.readAsDataURL(file);
        }

        function resetFileInput() {
            $('#recipeImageFile').val('');
            $('#fileName').text('Файл не обрано');
        }

        function updatePreview() {
            const title = $('#recipeTitle').val() || 'Назва рецепту';
            const category = $('#recipeCategory').val() || 'не вибрано';
            
            if (selectedFile) {
                $('#previewImage').attr('src', selectedFile);
            }
            
            $('#previewTitle').text(title);
            $('#previewCategory').text('Категорія: ' + category);
            $('#recipePreview').show();
        }

        // Сжатие изображения для уменьшения размера
        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Максимальные размеры
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 600;
                        
                        let width = img.width;
                        let height = img.height;
                        
                        // Изменяем размеры пропорционально
                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        // Рисуем сжатое изображение
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Конвертируем в Blob с качеством 75%
                        canvas.toBlob(blob => {
                            resolve(blob);
                        }, 'image/jpeg', 0.75);
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        // Загрузка изображения в Firebase Storage
        async function uploadImage(file) {
            try {
                // Сжимаем изображение
                const compressedBlob = await compressImage(file);
                
                // Создаем уникальное имя файла
                const fileName = `recipe-${Date.now()}-${Math.floor(Math.random() * 1000)}.jpg`;
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`recipe-images/${fileName}`);
                
                // Загружаем файл
                await fileRef.put(compressedBlob);
                
                // Получаем URL для скачивания
                return await fileRef.getDownloadURL();
            } catch (error) {
                console.error("Помилка завантаження зображення:", error);
                throw new Error("Не вдалося завантажити зображення");
            }
        }

        // Обработка отправки формы
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Показываем спиннер
            $('#submitSpinner').show();
            $('#recipeForm button').prop('disabled', true);
            
            try {
                const fileInput = document.getElementById('recipeImageFile');
                const file = fileInput.files[0];
                
                let imageUrl = 'images/default-recipe.jpg';
                
                // Загружаем изображение, если оно есть
                if (file) {
                    imageUrl = await uploadImage(file);
                }
                
                // Создаем объект рецепта
                const recipe = {
                    title: $('#recipeTitle').val(),
                    category: $('#recipeCategory').val(),
                    image: imageUrl,
                    ingredients: $('#recipeIngredients').val(),
                    instructions: $('#recipeInstructions').val(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Сохраняем в Firestore
                await db.collection("recipes").add(recipe);
                
                // Сброс формы
                $('#recipeForm')[0].reset();
                $('#recipePreview').hide();
                resetFileInput();
                selectedFile = null;
                
                // Перезагружаем рецепты
                await loadRecipes();
                
                alert('Рецепт успішно додано!');
                
                // Прокрутка к новому рецепту
                $('html, body').animate({
                    scrollTop: $('#user-recipes').offset().top - 100
                }, 800);
            } catch (error) {
                console.error("Помилка збереження рецепту:", error);
                alert('Сталася помилка: ' + error.message);
            } finally {
                // Скрываем спиннер и активируем кнопку
                $('#submitSpinner').hide();
                $('#recipeForm button').prop('disabled', false);
            }
        }

        // Загрузка рецептов
        async function loadRecipes() {
            try {
                // Показываем индикатор загрузки
                $('#loadingRecipes').show();
                $('#recipesContainer').empty();
                $('#noRecipesMessage').addClass('d-none');
                $('#loadMoreBtn').addClass('d-none');
                
                // Запрос к Firestore
                const query = db.collection("recipes")
                    .orderBy("createdAt", "desc")
                    .limit(PAGE_SIZE);
                
                const snapshot = await query.get();
                
                // Скрываем индикатор загрузки
                $('#loadingRecipes').hide();
                
                if (snapshot.empty) {
                    $('#noRecipesMessage').removeClass('d-none');
                    return;
                }
                
                // Сохраняем последний документ для пагинации
                lastVisible = snapshot.docs[snapshot.docs.length - 1];
                
                // Отображаем рецепты
                displayRecipes(snapshot);
                
                // Показываем кнопку "Загрузить еще", если есть еще рецепты
                if (snapshot.size === PAGE_SIZE) {
                    $('#loadMoreBtn').removeClass('d-none');
                }
            } catch (error) {
                console.error("Помилка завантаження рецептів:", error);
                $('#loadingRecipes').html('<p class="text-danger">Помилка завантаження рецептів. Спробуйте оновити сторінку.</p>');
            }
        }

        // Загрузка дополнительных рецептов
        async function loadMoreRecipes() {
            try {
                $('#loadMoreBtn').prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span>Завантаження...');
                
                const query = db.collection("recipes")
                    .orderBy("createdAt", "desc")
                    .startAfter(lastVisible)
                    .limit(PAGE_SIZE);
                
                const snapshot = await query.get();
                
                if (snapshot.empty) {
                    $('#loadMoreBtn').hide();
                    return;
                }
                
                // Обновляем последний документ
                lastVisible = snapshot.docs[snapshot.docs.length - 1];
                
                // Добавляем новые рецепты
                displayRecipes(snapshot);
                
                // Скрываем кнопку, если больше нет рецептов
                if (snapshot.size < PAGE_SIZE) {
                    $('#loadMoreBtn').hide();
                } else {
                    $('#loadMoreBtn').prop('disabled', false).text('Показати ще');
                }
            } catch (error) {
                console.error("Помилка завантаження рецептів:", error);
                $('#loadMoreBtn').prop('disabled', false).text('Показати ще');
                alert('Помилка завантаження додаткових рецептів');
            }
        }

        // Отображение рецептов на странице
        function displayRecipes(snapshot) {
            const container = $('#recipesContainer');
            
            snapshot.forEach(doc => {
                const recipe = doc.data();
                const recipeId = doc.id;
                
                // Форматируем дату
                const date = recipe.createdAt ? 
                    new Date(recipe.createdAt.toDate()).toLocaleDateString('uk-UA', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    }) : 'Дата не вказана';
                
                const recipeHtml = `
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="menu-thumb recipe-card">
                        <div class="menu-image-wrap position-relative">
                            <a href="javascript:void(0);" onclick="showRecipeDetails('${recipeId}')">
                                <img 
                                    src="${recipe.image}" 
                                    class="img-fluid menu-image" 
                                    alt="${recipe.title}" 
                                    loading="lazy"
                                >
                                <span class="user-recipe-tag bg-success">Користувацький</span>
                            </a>
                        </div>
                        <div class="menu-info d-flex flex-wrap align-items-center">
                            <h4 class="mb-0">${recipe.title}</h4>
                            <span class="text-muted small ms-2">${date}</span>
                        </div>
                    </div>
                </div>`;
                
                container.append(recipeHtml);
            });
        }

        // Показ деталей рецепта
        window.showRecipeDetails = async function(recipeId) {
            try {
                const doc = await db.collection("recipes").doc(recipeId).get();
                
                if (!doc.exists) {
                    alert('Рецепт не знайдено');
                    return;
                }
                
                const recipe = doc.data();
                
                // Форматируем дату
                const date = recipe.createdAt ? 
                    new Date(recipe.createdAt.toDate()).toLocaleDateString('uk-UA', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : 'Дата не вказана';
                
                // Создаем HTML для модального окна
                const modalHtml = `
                <div class="modal fade recipe-modal" id="recipeDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${recipe.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-5 mb-3 mb-md-0">
                                        <img 
                                            src="${recipe.image}" 
                                            class="img-fluid rounded mb-3" 
                                            alt="${recipe.title}"
                                        >
                                        <div class="recipe-meta">
                                            <p><strong>Категорія:</strong> ${recipe.category || 'Не вказана'}</p>
                                            <p><strong>Додано:</strong> ${date}</p>
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="mb-4">
                                            <h5>Інгредієнти:</h5>
                                            <div class="recipe-ingredients">${formatText(recipe.ingredients)}</div>
                                        </div>
                                        <div>
                                            <h5>Інструкція:</h5>
                                            <div class="recipe-instructions">${formatText(recipe.instructions)}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                            </div>
                        </div>
                    </div>
                </div>`;
                
                // Добавляем модальное окно в DOM
                $('body').append(modalHtml);
                
                // Показываем модальное окно
                const modal = new bootstrap.Modal(document.getElementById('recipeDetailModal'));
                modal.show();
                
                // Удаляем модальное окно после закрытия
                $('#recipeDetailModal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            } catch (error) {
                console.error("Помилка завантаження рецепту:", error);
                alert('Не вдалося завантажити рецепт');
            }
        }

        // Форматирование текста (замена переносов строк)
        function formatText(text) {
            return text.replace(/\n/g, '<br>');
        }
    </script>
</body>
</html>