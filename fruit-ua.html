<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Хрустка кухня - Фрукти на зиму</title>
    
    <!-- CSS FILES -->  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">                      
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-icons.css" rel="stylesheet">
    <link href="css/tooplate-crispy-kitchen.css" rel="stylesheet">
<style>
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-label {
            display: block;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .file-input-label:hover {
            background-color: #f8f9fa;
        }
        
        .file-input-label input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        .file-name {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .recipe-preview {
            margin-top: 2rem;
            display: none;
        }
        
        .recipe-card {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: transform 0.3s ease;
        }
        
        .recipe-card:hover {
            transform: translateY(-5px);
        }
        
        .user-recipe-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        
        .menu-image-wrap {
            position: relative;
        }
        
        .recipe-form {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .form-title {
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #198754;
        }
        
        .carousel-link {
            display: block;
            position: relative;
            color: inherit;
            text-decoration: none;
        }
        
        .carousel-link:hover {
            text-decoration: none;
        }
        
        .carousel-link .carousel-caption {
            z-index: 10;
        }
        
        .carousel-link::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            display: none;
        }
        
        #loadingRecipes {
            text-align: center;
            padding: 2rem;
        }
        
        .recipe-modal .modal-content {
            border-radius: 0.8rem;
            overflow: hidden;
        }
        
        .recipe-modal .modal-header {
            background: linear-gradient(to right, #28a745, #20c997);
            color: white;
            border-bottom: none;
        }
        
        .recipe-modal .modal-body {
            padding: 1.5rem;
        }
        
        .recipe-modal .modal-footer {
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .recipe-ingredients {
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .recipe-instructions {
            white-space: pre-line;
            line-height: 1.8;
        }
    </style>
</head>
    
<body>
    <nav class="navbar navbar-expand-lg bg-white shadow-lg">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <a class="navbar-brand" href="index.html">Хрустка кухня</a>

            <div class="d-lg-none"></div>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Головна</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="top-ua.html">Перші страви</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="top2-ua.html">Другі страви</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="desert-ua.html">Десерт</a>
                    </li>
                    
                    <li class="nav-item">
                        <a href="fruit-ru.html"><span class="category-tag me-3 bg-info">RU</span></a>                  
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main>
        <header class="site-header site-news-detail-header">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h2>Фрукти на зиму</h2>
                    </div>
                </div>
            </div>
        </header>

        <section class="news-detail section-padding pt-0">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-12">
                        <img src="images/news/news-detail-header14.jpg" class="img-fluid news-detail-image" alt="Фрукти">

                        <div class="col-lg-10 col-10 mx-auto mt-5">
                            <h4 class="mb-3">Фруктові заготовки</h4>
                            <p>
                                Фрукти - це справжній дар природи, який можна зберегти на зиму у різних видах. 
                                Яблука, груші, сливи, абрикоси, персики та ягоди перетворюються на найсмачніші джеми, 
                                компоти, вариння та цукати. Консервовані фрукти зберігають вітаміни та корисні речовини, 
                                а також дарують літній настрій холодними зимовими вечорами. Незалежно від обраного способу 
                                консервації, фруктові заготовки робляться досить швидко, а результат завжди радує 
                                різноманітністю смаків та ароматів.
                            </p>

                            <h4 class="mb-3">Яблучний компот з корицею</h4>
                            <ul class="list">
                                <li class="list-item">На 3-літрову банку:</li>
                                <li class="list-item">1 кг яблук</li>
                                <li class="list-item">200 г цукру</li>
                                <li class="list-item">1 паличка кориці</li>
                                <li class="list-item">3-4 бруньки гвоздики</li>
                                <li class="list-item">Лимонна кислота на кінчику ножа</li>
                            </ul>
                            <p>
                                Яблука вимийте, видаліть серцевину та наріжте скибочками. Укладіть у стерилізовані банки, 
                                додайте корицю та гвоздику. Приготуйте сироп: закип'ятіть воду з цукром. Залейте окропом 
                                яблука у банках. Додайте лимонну кислоту. Стерилізуйте 15-20 хвилин при 90°C, 
                                потім закатайте банки.
                            </p>

                            <h4 class="mb-3">Персикове вариння</h4>
                            <p>
                                Стиглі персики вимийте, видаліть кісточки та наріжте скибочками. На 1 кг персиків візьміть 
                                1 кг цукру та сік 1 лимона. Складіть персики в каструлю, пересипте цукром і залиште на 3-4 години. 
                                Потім поставте на повільний вогонь, додайте лимонний сік і варіть після закипання 30-40 хвилин, 
                                знімаючи піну. Готове вариння розлийте по стерилізованим банкам і закатайте.
                            </p>

                            <h4 class="mb-3">Груші в сиропі з ваніллю</h4>
                            <ul class="list">
                                <li class="list-item">На літрову банку:</li>
                                <li class="list-item">700 г твердих груш</li>
                                <li class="list-item">300 г цукру</li>
                                <li class="list-item">1/2 стручка ванілі</li>
                                <li class="list-item">1 ч. ложка лимонної кислоти</li>
                            </ul>
                            <p>
                                Груші очистіть від шкірки, розріжте навпіл і видаліть серцевину. Укладіть у банки. 
                                Приготуйте сироп: розчиніть цукор у 700 мл води, додайте ваніль та лимонну кислоту. 
                                Доведіть до кипіння і залийте груші. Стерилізуйте банки 15 хвилин при 90°C, потім закатайте.
                            </p>

                            <h4 class="mb-3">Сливове пюре з корицею</h4>
                            <ul class="list">
                                <li class="list-item">На 1 кг слив:</li>
                                <li class="list-item">200 г цукру</li>
                                <li class="list-item">1 ч. ложка меленої кориці</li>
                                <li class="list-item">Сік 1/2 лимона</li>
                            </ul>
                            <p>
                                Сливи вимийте, видаліть кісточки. Проваріть 10 хвилин у невеликій кількості води до м'якості. 
                                Протріть через сито або подрібніть блендером. Додайте цукор, корицю та лимонний сік. 
                                Варіть на повільному вогні 20 хвилин, постійно помішуючи. Гаряче пюре розлийте по стерилізованим 
                                банкам і закатайте.
                            </p>
                            
                            <h4 class="mb-3">Абрикоси у власному соку</h4>
                            <ul class="list">
                                <li class="list-item">На 3-літрову банку:</li>
                                <li class="list-item">2 кг абрикосів</li>
                                <li class="list-item">100 г цукру</li>
                            </ul>
                            <p>
                                Абрикоси вимийте, розріжте навпіл і видаліть кісточки. Щільно укладіть у банки, 
                                пересипаючи цукром. Закрийте кришками і стерилізуйте 30 хвилин при 90°C. Закатайте, 
                                переверніть банки й укрийте до охолодження.
                            </p>
                            
                            <h4 class="mb-3">Фруктовий мікс у сиропі</h4>
                            <ul class="list">
                                <li class="list-item">На 3-літрову банку:</li>
                                <li class="list-item">500 г яблук</li>
                                <li class="list-item">500 г груш</li>
                                <li class="list-item">500 г слив</li>
                                <li class="list-item">300 г цукру</li>
                                <li class="list-item">3-4 горошини духмяного перцю</li>
                                <li class="list-item">2 бруньки гвоздики</li>
                                <li class="list-item">Шматочок імбиру (1 см)</li>
                            </ul>
                            <p>
                                Фрукти вимийте, очистіть і наріжте скибочками. Укладіть у банку шарами. Додайте спеції. 
                                Приготуйте сироп з води та цукру, залийте окропом фрукти. Стерилізуйте 25 хвилин 
                                при 90°C, потім закатайте.
                            </p>
                            
                            <h4 class="mb-3">Полуничний джем</h4>
                            <ul class="list">
                                <li class="list-item">На 1 кг полуниці:</li>
                                <li class="list-item">800 г цукру</li>
                                <li class="list-item">Сік 1 лимона</li>
                            </ul>
                            <p>
                                Полуницю вимийте, обсушіть і засипте цукром. Залиште на 4-5 годин. Додайте лимонний сік, 
                                доведіть до кипіння на повільному вогні. Варіть 30-40 хвилин, знімаючи піну. Готовність перевірте 
                                краплею на блюдці - вона не повинна розтікатися. Розлийте гарячий джем по банках і закатайте.
                            </p>

                            <h4 class="mb-3">Вишня у власному соку</h4>
                            <ul class="list">
                                <li class="list-item">На літрову банку:</li>
                                <li class="list-item">700 г вишні</li>
                                <li class="list-item">100 г цукру</li>
                            </ul>
                            <p>
                                Вишню вимийте, видаліть кісточки (за бажанням). Укладіть у банки, пересипаючи цукром. 
                                Закрийте кришками і стерилізуйте 20 хвилин при 90°C. Закатайте, переверніть і укрийте.
                            </p>
                            
                            <div class="col-12">
                                <h2>Сухофрукти та цукати</h2>
                            </div>
                            
                            <div class="col-lg-12 col-12">
                                <img src="images/news/farhad-ibrahimzade-D5c9ZciQy_I-unsplash.jpg" class="img-fluid news-detail-image" alt="Сухофрукти">
                            </div>
                            
                            <h4 class="mb-3">Яблучні чіпси</h4>
                            <ul class="list">
                                <li class="list-item">На 1 кг яблук:</li>
                                <li class="list-item">1 ст. ложка лимонного соку</li>
                                <li class="list-item">1 ч. ложка кориці</li>
                            </ul>
                            <p>
                                Яблука вимийте, видаліть серцевину та наріжте тонкими кружальцями. Збризніть лимонним соком, 
                                посипте корицею. Розкладіть на деко з пергаментом. Сушіть у духовці при 70°C 4-5 годин 
                                з напіввідкритими дверцятами. Зберігайте у скляних банках.
                            </p>
                            
                            <h4 class="mb-3">Цукати з апельсинових шкірок</h4>
                            <ul class="list">
                                <li class="list-item">Шкірка 5 апельсинів</li>
                                <li class="list-item">500 г цукру</li>
                                <li class="list-item">300 мл води</li>
                            </ul>
                            <p>
                                Шкірку наріжте смужками, залийте водою та варіть 15 хвилин. Злийте воду, повторіть 3 рази. 
                                Приготуйте сироп з цукру та води, додайте шкірки. Варіть на повільному вогні 1 годину. Відкиньте 
                                на друшляк, дайте стікти сиропу. Обваляйте в цукрі й сушіть 24 години при кімнатній температурі.
                            </p>
                            
                            <h4 class="mb-3">Сушені сливи</h4>
                            <ul class="list">
                                <li class="list-item">Стиглі сливи</li>
                            </ul>
                            <p>
                                Сливи вимийте, розріжте навпіл і видаліть кісточки. Розкладіть на деко зрізом догори. 
                                Сушіть у духовці при 70°C 8-10 годин з напіввідкритими дверцятами. Зберігайте у полотняних мішечках.
                            </p>

                            <h4 class="mb-3">Зацукрований імбир та апельсини</h4>
                            <ul class="list">
                                <li class="list-item">2 апельсини</li>
                                <li class="list-item">100 г кореня імбиру</li>
                                <li class="list-item">500 г цукру</li>
                                <li class="list-item">500 мл води</li>
                            </ul>
                            <p>
                                Апельсини наріжте тонкими кружальцями, імбир - скибочками. Варіть у сиропі 1 годину на повільному вогні. 
                                Витягніть з сиропу, обваляйте в цукрі. Сушіть при кімнатній температурі 24 години. Зберігайте у скляних банках.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="BgImage"></section>

        <!-- Секция для добавления рецептов -->
        <section id="add-recipe" class="section-padding">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-12">
                        <div class="recipe-form">
                            <h2 class="form-title">Додати свій рецепт</h2>
                            <form id="recipeForm">
                                <div class="mb-3">
                                    <label for="recipeTitle" class="form-label">Назва рецепту*</label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="recipeTitle" 
                                        required 
                                        placeholder="Введіть назву вашого рецепту"
                                    >
                                </div>
                                <div class="mb-3">
                                    <label for="recipeCategory" class="form-label">Категорія*</label>
                                    <select class="form-select" id="recipeCategory" required>
                                        <option value="">Виберіть категорію</option>
                                        <option value="Сніданок">Сніданок</option>
                                        <option value="Обід">Обід</option>
                                        <option value="Вечеря">Вечеря</option>
                                        <option value="Десерт">Десерт</option>
                                        <option value="Пістне">Пістне</option>
                                        <option value="Консервація">Консервація</option>
                                        <option value="Випічка">Випічка</option>
                                        <option value="Напої">Напої</option>
                                        <option value="Салати">Салати</option>
                                        <option value="Закуски">Закуски</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Зображення (опціонально)</label>
                                    <div class="file-input-wrapper">
                                        <div class="file-input-label">
                                            <i class="bi bi-upload me-2"></i>Обрати файл
                                            <input 
                                                type="file" 
                                                class="form-control" 
                                                id="recipeImageFile" 
                                                accept="image/*"
                                            >
                                        </div>
                                        <span id="fileName" class="file-name">Файл не обрано</span>
                                    </div>
                                    <div class="form-text">Максимальний розмір: 1MB (JPG, PNG)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="recipeIngredients" class="form-label">Інгредієнти*</label>
                                    <textarea 
                                        class="form-control" 
                                        id="recipeIngredients" 
                                        rows="4" 
                                        required 
                                        placeholder="Перелічіть інгредієнти, кожен з нового рядка"
                                    ></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="recipeInstructions" class="form-label">Інструкція приготування*</label>
                                    <textarea 
                                        class="form-control" 
                                        id="recipeInstructions" 
                                        rows="6" 
                                        required 
                                        placeholder="Опишіть кроки приготування"
                                    ></textarea>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <span 
                                            id="submitSpinner" 
                                            class="spinner-border spinner-border-sm me-2" 
                                            role="status" 
                                            aria-hidden="true"
                                        ></span>
                                        Додати рецепт
                                    </button>
                                </div>
                            </form>
                            
                            <div id="recipePreview" class="recipe-preview mt-4">
                                <h4>Попередній перегляд:</h4>
                                <div class="card recipe-card">
                                    <img 
                                        id="previewImage" 
                                        src="images/default-recipe.jpg" 
                                        class="card-img-top" 
                                        alt="Попередній перегляд"
                                    >
                                    <div class="card-body">
                                        <h5 id="previewTitle" class="card-title">Назва рецепту</h5>
                                        <p id="previewCategory" class="card-text text-muted">Категорія: не вибрано</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Раздел для отображения пользовательских рецептов -->
        <section id="user-recipes" class="section-padding bg-white">
            <div class="container">
                <div class="row">
                    <h2 class="text-center mb-lg-5 mb-4">Рецепти від користувачів</h2>
                    
                    <div id="loadingRecipes">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Завантаження...</span>
                        </div>
                        <p class="mt-3">Завантажуємо рецепти...</p>
                    </div>
                    
                    <div id="recipesContainer" class="row">
                        <!-- Сюда будут добавляться рецепты через JS -->
                    </div>
                    
                    <div id="noRecipesMessage" class="col-12 text-center d-none">
                        <p>Поки немає доданих рецептів. Будьте першим!</p>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button id="loadMoreBtn" class="btn btn-outline-success d-none">Показати ще</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer section-padding">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h4 class="text-white mb-4 me-5">Хрустка кухня</h4>
                </div>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT FILES -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/custom.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <script>
        // Конфигурация Firebase (ЗАМЕНИТЕ НА ВАШУ КОНФИГУРАЦИЮ)
        const firebaseConfig = {
            apiKey: "ВАШ_API_KEY",
            authDomain: "ВАШ_PROJECT.firebaseapp.com",
            projectId: "ВАШ_PROJECT",
            storageBucket: "ВАШ_PROJECT.appspot.com",
            messagingSenderId: "ВАШ_SENDER_ID",
            appId: "ВАШ_APP_ID"
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Глобальные переменные
        let lastVisible = null;
        let selectedFile = null;
        const PAGE_SIZE = 6; // Количество рецептов за одну загрузку

        $(document).ready(function() {
            // Загрузка первых рецептов
            loadRecipes();
            
            // Обработчики событий
            $('#recipeForm').submit(handleFormSubmit);
            $('#recipeImageFile').on('change', handleImageUpload);
            $('#recipeTitle, #recipeCategory').on('input change', updatePreview);
            $('#loadMoreBtn').on('click', loadMoreRecipes);
        });

        // Обработка загрузки изображения
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) {
                $('#fileName').text('Файл не обрано');
                selectedFile = null;
                return;
            }

            // Проверка типа файла
            if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                alert('Будь ласка, виберіть файл у форматі JPG або PNG.');
                resetFileInput();
                return;
            }

            // Проверка размера файла
            if (file.size > 1048576) {
                alert('Файл занадто великий. Максимальний розмір 1MB.');
                resetFileInput();
                return;
            }

            $('#fileName').text(file.name);
            
            const reader = new FileReader();
            reader.onload = function(event) {
                selectedFile = event.target.result;
                updatePreview();
            };
            reader.readAsDataURL(file);
        }

        function resetFileInput() {
            $('#recipeImageFile').val('');
            $('#fileName').text('Файл не обрано');
        }

        function updatePreview() {
            const title = $('#recipeTitle').val() || 'Назва рецепту';
            const category = $('#recipeCategory').val() || 'не вибрано';
            
            if (selectedFile) {
                $('#previewImage').attr('src', selectedFile);
            }
            
            $('#previewTitle').text(title);
            $('#previewCategory').text('Категорія: ' + category);
            $('#recipePreview').show();
        }

        // Сжатие изображения для уменьшения размера
        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Максимальные размеры
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 600;
                        
                        let width = img.width;
                        let height = img.height;
                        
                        // Изменяем размеры пропорционально
                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        // Рисуем сжатое изображение
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Конвертируем в Blob с качеством 75%
                        canvas.toBlob(blob => {
                            resolve(blob);
                        }, 'image/jpeg', 0.75);
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        // Загрузка изображения в Firebase Storage
        async function uploadImage(file) {
            try {
                // Сжимаем изображение
                const compressedBlob = await compressImage(file);
                
                // Создаем уникальное имя файла
                const fileName = `recipe-${Date.now()}-${Math.floor(Math.random() * 1000)}.jpg`;
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`recipe-images/${fileName}`);
                
                // Загружаем файл
                await fileRef.put(compressedBlob);
                
                // Получаем URL для скачивания
                return await fileRef.getDownloadURL();
            } catch (error) {
                console.error("Помилка завантаження зображення:", error);
                throw new Error("Не вдалося завантажити зображення");
            }
        }

        // Обработка отправки формы
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Показываем спиннер
            $('#submitSpinner').show();
            $('#recipeForm button').prop('disabled', true);
            
            try {
                const fileInput = document.getElementById('recipeImageFile');
                const file = fileInput.files[0];
                
                let imageUrl = 'images/default-recipe.jpg';
                
                // Загружаем изображение, если оно есть
                if (file) {
                    imageUrl = await uploadImage(file);
                }
                
                // Создаем объект рецепта
                const recipe = {
                    title: $('#recipeTitle').val(),
                    category: $('#recipeCategory').val(),
                    image: imageUrl,
                    ingredients: $('#recipeIngredients').val(),
                    instructions: $('#recipeInstructions').val(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Сохраняем в Firestore
                await db.collection("recipes").add(recipe);
                
                // Сброс формы
                $('#recipeForm')[0].reset();
                $('#recipePreview').hide();
                resetFileInput();
                selectedFile = null;
                
                // Перезагружаем рецепты
                await loadRecipes();
                
                alert('Рецепт успішно додано!');
                
                // Прокрутка к новому рецепту
                $('html, body').animate({
                    scrollTop: $('#user-recipes').offset().top - 100
                }, 800);
            } catch (error) {
                console.error("Помилка збереження рецепту:", error);
                alert('Сталася помилка: ' + error.message);
            } finally {
                // Скрываем спиннер и активируем кнопку
                $('#submitSpinner').hide();
                $('#recipeForm button').prop('disabled', false);
            }
        }

        // Загрузка рецептов
        async function loadRecipes() {
            try {
                // Показываем индикатор загрузки
                $('#loadingRecipes').show();
                $('#recipesContainer').empty();
                $('#noRecipesMessage').addClass('d-none');
                $('#loadMoreBtn').addClass('d-none');
                
                // Запрос к Firestore
                const query = db.collection("recipes")
                    .orderBy("createdAt", "desc")
                    .limit(PAGE_SIZE);
                
                const snapshot = await query.get();
                
                // Скрываем индикатор загрузки
                $('#loadingRecipes').hide();
                
                if (snapshot.empty) {
                    $('#noRecipesMessage').removeClass('d-none');
                    return;
                }
                
                // Сохраняем последний документ для пагинации
                lastVisible = snapshot.docs[snapshot.docs.length - 1];
                
                // Отображаем рецепты
                displayRecipes(snapshot);
                
                // Показываем кнопку "Загрузить еще", если есть еще рецепты
                if (snapshot.size === PAGE_SIZE) {
                    $('#loadMoreBtn').removeClass('d-none');
                }
            } catch (error) {
                console.error("Помилка завантаження рецептів:", error);
                $('#loadingRecipes').html('<p class="text-danger">Помилка завантаження рецептів. Спробуйте оновити сторінку.</p>');
            }
        }

        // Загрузка дополнительных рецептов
        async function loadMoreRecipes() {
            try {
                $('#loadMoreBtn').prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span>Завантаження...');
                
                const query = db.collection("recipes")
                    .orderBy("createdAt", "desc")
                    .startAfter(lastVisible)
                    .limit(PAGE_SIZE);
                
                const snapshot = await query.get();
                
                if (snapshot.empty) {
                    $('#loadMoreBtn').hide();
                    return;
                }
                
                // Обновляем последний документ
                lastVisible = snapshot.docs[snapshot.docs.length - 1];
                
                // Добавляем новые рецепты
                displayRecipes(snapshot);
                
                // Скрываем кнопку, если больше нет рецептов
                if (snapshot.size < PAGE_SIZE) {
                    $('#loadMoreBtn').hide();
                } else {
                    $('#loadMoreBtn').prop('disabled', false).text('Показати ще');
                }
            } catch (error) {
                console.error("Помилка завантаження рецептів:", error);
                $('#loadMoreBtn').prop('disabled', false).text('Показати ще');
                alert('Помилка завантаження додаткових рецептів');
            }
        }

        // Отображение рецептов на странице
        function displayRecipes(snapshot) {
            const container = $('#recipesContainer');
            
            snapshot.forEach(doc => {
                const recipe = doc.data();
                const recipeId = doc.id;
                
                // Форматируем дату
                const date = recipe.createdAt ? 
                    new Date(recipe.createdAt.toDate()).toLocaleDateString('uk-UA', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    }) : 'Дата не вказана';
                
                const recipeHtml = `
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="menu-thumb recipe-card">
                        <div class="menu-image-wrap position-relative">
                            <a href="javascript:void(0);" onclick="showRecipeDetails('${recipeId}')">
                                <img 
                                    src="${recipe.image}" 
                                    class="img-fluid menu-image" 
                                    alt="${recipe.title}" 
                                    loading="lazy"
                                >
                                <span class="user-recipe-tag bg-success">Користувацький</span>
                            </a>
                        </div>
                        <div class="menu-info d-flex flex-wrap align-items-center">
                            <h4 class="mb-0">${recipe.title}</h4>
                            <span class="text-muted small ms-2">${date}</span>
                        </div>
                    </div>
                </div>`;
                
                container.append(recipeHtml);
            });
        }

        // Показ деталей рецепта
        window.showRecipeDetails = async function(recipeId) {
            try {
                const doc = await db.collection("recipes").doc(recipeId).get();
                
                if (!doc.exists) {
                    alert('Рецепт не знайдено');
                    return;
                }
                
                const recipe = doc.data();
                
                // Форматируем дату
                const date = recipe.createdAt ? 
                    new Date(recipe.createdAt.toDate()).toLocaleDateString('uk-UA', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : 'Дата не вказана';
                
                // Создаем HTML для модального окна
                const modalHtml = `
                <div class="modal fade recipe-modal" id="recipeDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${recipe.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-5 mb-3 mb-md-0">
                                        <img 
                                            src="${recipe.image}" 
                                            class="img-fluid rounded mb-3" 
                                            alt="${recipe.title}"
                                        >
                                        <div class="recipe-meta">
                                            <p><strong>Категорія:</strong> ${recipe.category || 'Не вказана'}</p>
                                            <p><strong>Додано:</strong> ${date}</p>
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="mb-4">
                                            <h5>Інгредієнти:</h5>
                                            <div class="recipe-ingredients">${formatText(recipe.ingredients)}</div>
                                        </div>
                                        <div>
                                            <h5>Інструкція:</h5>
                                            <div class="recipe-instructions">${formatText(recipe.instructions)}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                            </div>
                        </div>
                    </div>
                </div>`;
                
                // Добавляем модальное окно в DOM
                $('body').append(modalHtml);
                
                // Показываем модальное окно
                const modal = new bootstrap.Modal(document.getElementById('recipeDetailModal'));
                modal.show();
                
                // Удаляем модальное окно после закрытия
                $('#recipeDetailModal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            } catch (error) {
                console.error("Помилка завантаження рецепту:", error);
                alert('Не вдалося завантажити рецепт');
            }
        }

        // Форматирование текста (замена переносов строк)
        function formatText(text) {
            return text.replace(/\n/g, '<br>');
        }
    </script>
</body>
</html>